<!doctype html>
<html class="no-js" lang="en" xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/layout(title='마이페이지')">

<head>
	<title>Safira - my account</title>
	<style>
		.modal-dialog {
			margin: auto;
			margin-top: 20vh;
			/* 회원탈퇴창 가운데 정도로 떨어트림 */
			
		}
		
		#volunteerTable{
		width: 1000px;
		}
	</style>

</head>

<body>

	<!--header area start-->
	<th:block layout:fragment="content">
		<!--offcanvas menu area start-->
		<!-- <div class="off_canvars_overlay">
                
    </div>
    <div class="offcanvas_menu">
       
		<!--offcanvas menu area end-->


		<!--header area end-->

		<!--breadcrumbs area start-->
		<!-- <div class="breadcrumbs_area">
        
    </div> -->
		<!--breadcrumbs area end-->

		<!-- my account start  -->
		<section class="main_content_area">
			<div class="container">
				<div class="account_dashboard">
					<div class="row">
						<div class="col-sm-12 col-md-3 col-lg-3">
							<!-- Nav tabs -->
							<div class="dashboard_tab_button">
								<ul role="tablist" class="nav flex-column dashboard-list">
									<li><a href="adminUserList" class="nav-link">회원</a></li>
	                                <li><a href="adminProductList"  class="nav-link">상품</a></li>
	                                <li><a href="adminOrdersList" class="nav-link">주문</a></li>
	                                <li><a href="adoptByUserNo"  class="nav-link">입양</a></li>
									<li><a href="adminVolunteerList"class="nav-link">봉사</a></li>
	                                <li><a href="adminVisitList"class="nav-link">견학</a></li>
									<li><a href="centerListAll"class="nav-link">보호소</a></li>
								</ul>
							</div>
						</div>
						<div class="col-sm-12 col-md-9 col-lg-9">
							<!-- Tab panes -->
							<div class="tab-content dashboard_content">





								<!--  <div class="tab-pane fade" id="visit">-->
								<h3>봉사</h3>
								<div class="table-responsive" id="volunteerTable">
									<table class="table" >
										<thead>
											<tr>
												<th>No</th>
												<th>Time</th>
												<th>Date</th>
												<th>Center</th>
												<th>Status</th>
												<th>Update/Delete</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="volunteer, rowStat : ${volunteerList}">
												<td th:text="${volunteerList.size() - rowStat.index}"></td>			
												<td th:text="${#strings.substring(volunteer.volunteerDate.toString(), 0, 10)}"></td>
												
												
												<td> <!-- 13PM, 14PM ... 18PM -->
													<span th:if="${volunteer.volunteerTime < 12}"
														th:text="${volunteer.volunteerTime + ' AM'}"></span>
													<span th:if="${volunteer.volunteerTime >= 12}"
														th:text="${volunteer.volunteerTime + ' PM'}"></span>
												</td>
												
												
												<td th:text="${volunteer.Center.centerName}"></td>
												
												
												<td th:text="${volunteer.volunteerStatus}"><span class="success">견학신청</span></td>
												
												<td>
													<a th:if="${session.userName == '관리자'}" th:href="@{/updateVolunteer/{volunteerNo}(volunteerNo=${volunteer.volunteerNo})}" class="updateBtn">완료</a>
													
												
													<button type="submit" class="deleteBtn"
														th:id="'deleteBtn-' + ${volunteer.volunteerNo}">취소</button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>


		<!-- my account end   -->

		<!--footer area start-->


		<!--footer area end-->

		
		<script>
			$('.deleteBtn').on('click', function (e) {
				e.preventDefault();
				let id = $(this).attr('id');
				let no = id.split('-')[1];

				if (isNaN(no)) {
					alert('volunteerNo 가져오기실패')
					return;
				}

				let sendJsonObject = {visitNo: no};
				let $row = $(this).closest('tr');

				$.ajax({
					type: 'DELETE',
					url: 'volunteer/' + no,
					data: JSON.stringify(sendJsonObject),
					contentType: 'application/json;UTF-8',
					success: function (response) {
						if (response && response.volunteerNo == null) {
							alert('신청내역이 없음');
						} else {
							alert('예약취소가 완료되었습니다.');
							$row.remove();
							window.location.href = "adminVolunteerList"
						}
					},
					error: function () {
						alert('취소 요청중 오류가 발생했습니다.');
					}
				});
			});

		</script>
	</th:block>



</body>

</html>